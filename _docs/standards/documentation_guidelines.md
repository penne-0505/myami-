# ドキュメント整備指針

**ドキュメンテーションでわからないことがあれば、まずこのファイルを確認してください。**

**アーカイブ運用・承認フローは `_docs/standards/documentation_operations.md` に定義されたルールに必ず従ってください。違反はレビューでブロックされます。**

## 概要

本指針は、このプロジェクトにおけるドキュメント作成・管理・メンテナンスの統一的な方針を定めるものです。運用プロセスや自動化の詳細は `_docs/standards/documentation_operations.md` を参照し、本書では日々の執筆・レビューの実務指針にフォーカスします。

## 関連ドキュメント
- `_docs/standards/documentation_operations.md`: draft/plan を中心とした運用ルールと自動化ロードマップ
- `_docs/documentation_guide.md`: ドキュメント執筆者向けの実務ガイドライン

## ドキュメントの目的

1. **新メンバー・対象領域外の人が仕様・用法を理解するため**（主目的）
2. **実装上の意図を明確にするため**
3. **汎用的な参考資料として**

## ディレクトリ構造と役割

```
\_docs/
├── guide/(対象)/          \# 使用方法・運用指針・ベストプラクティス・トラブルシューティング
├── reference/(対象)/      \# API仕様・詳細リファレンス・簡易的内部実装説明
├── plan/(対象)/          \# 実装計画・仕様書（実装完了後も保持）
├── intent/(対象)/        \# 実装意図・背景・判断理由（ADR的な用途）
├── survey/(対象)/         \# 機能調査・技術比較・検証レポート
├── draft/(対象)/           \# メモ・草案置き場（正式化前の作業用）
├── standards/              \# 開発ガイドライン・プロジェクト標準（本ファイル含む）
├── archives/               \# intent 承認後に移送する保管庫

```

### `_docs/guide/(機能名)/` - 使用方法ガイド

- **目的**: 実際の開発シナリオでの使い方を学ぶ
- **読者**: 新メンバー・対象領域外の人（仕様・用法理解が目的）
- **内容**: 
  - 基本的な使用方法・操作手順
  - 運用・開発上の指針
  - チュートリアル
  - プロジェクト固有のベストプラクティス
  - トラブルシューティング
- **相互参照**: reference への根拠提示として積極的に参照
  - 例：「詳細な仕様は `reference/logging-api.md` を参照」

### `_docs/reference/(対象)/` - API仕様リファレンス

- **目的**: 特定のAPI仕様を確認する辞書的用途
- **読者**: 実装時に詳細な仕様を調べたい開発者
- **内容**:
  - クラス・メソッド単位の詳細説明
  - パラメータ・戻り値・例外の完全仕様
  - 簡易的な内部実装説明
- **ステータス**: 実装済み機能のみ記載
- **相互参照**: guide への実践例誘導として積極的に参照
  - 例：「実際の使用例は `guide/logging.md` のベストプラクティスを参照」

### `_docs/plan/(対象)/` - 実装計画・仕様書

- **目的**: 実装計画・技術仕様書の保管庫
- **読者**: 実装背景を理解したい開発者・新メンバー
- **内容**: 詳細仕様、実装計画概要、技術検討資料
- **ディレクトリ命名規則 (`(対象)`)**:
  - 本ディレクトリの第一階層名（`(対象)`）は、`TODO.md` における **Area** と1対1で対応する。
  - 原則として、タスク管理上の Area と一致するディレクトリ名を使用すること。
  - ディレクトリ名を変更する場合（リネーム）は、`TODO.md` 内の該当タスクの `Area` も同時に一括置換する必要がある。
- **ライフサイクル**: 実装完了後も削除せず、archiveの形を取ることでintent の原典として活用
- **特徴**: 計画段階・開発中・実装済み全ての機能を含む

### `_docs/intent/(対象)/` - 実装意図・設計判断

- **目的**: 実装上の意図・背景・判断理由の記録（ADR的用途）
- **読者**: 設計判断の背景を理解したい開発者
- **内容**: なぜその設計にしたか、検討した代替案、トレードオフ等
- **特徴**: 現状の事実（reference）と実装意図を分離管理
- **記録対象**: アーキテクチャ決定、技術選択、設計方針変更等

### `_docs/survey/(対象)/` - 調査レポート・検証結果

- **目的**: 調査・検証・比較検討の結果を体系的に蓄積し、意思決定や後続作業の根拠を共有する
- **読者**: 調査結果を踏まえて計画・実装を行う開発者、意思決定者
- **内容**:
  - 実装前の技術調査、性能計測レポート
  - 競合機能比較やUI/UXリサーチのまとめ
  - 検証手順・条件・結論の詳細記録
- **運用**:
  - 調査完了後に速報ベースのメモ（draft）から整理して移管
  - フォーマットは基本的に「背景 → 目的 → 手法 → 結果 → 考察 → 推奨アクション」を推奨
  - 計画ドキュメント（plan）や意図ドキュメント（intent）から参照し、根拠資料として活用
  - 調査後に行われた実装が完了したら、archives へ移送

> **補足**: 一時的・未整理のメモは引き続き `_docs/draft/` に置き、調査が完了したら `_docs/survey/` へ昇格させる。

### `_docs/draft/(対象)/` - メモ・草案置き場

- **目的**: メモ・草案の統一管理（正式ドキュメント化前の作業用）
- **読者**: 開発者・ドキュメント作成者
- **内容**: 
  - コミット時に残す実装意図メモ
  - 正式化前の草案
  - 作業中の一時的な資料
- **運用**: メモと草案を区別せず統一的に管理
- **ライフサイクル**: 正式ドキュメント化後は移動・削除

> **ドキュメント昇格フロー**: draft → survey（調査必要時） → plan → intent → guide/reference（詳細は `_docs/standards/documentation_operations.md` を参照）

#### draft の TTL と保守
- 各 draft は、`updated_at` から一定期間（既定30日）更新がない場合、stale と見なされる。
- 必要に応じて昇格/クローズ/延長の判断を行う。

### `_docs/standards/` - 開発ガイドライン・標準

- **目的**: プロジェクト全体の開発ガイドライン・標準の管理
- **読者**: 全プロジェクトメンバー
- **内容**: 本指針、コーディング規約、その他プロジェクト標準
- **特徴**: プロジェクト横断的なルール・方針を集約

## 必須フィールド一覧（全ドキュメント共通）

全てのドキュメントには front-matter を付与し、以下の6つの必須キーのみを管理する。
詳細なメタデータやドキュメントの内容定義は、後述するMarkdown本文のセクションとして記述する。

| フィールド | 説明 |
| --- | --- |
| `title` | ドキュメントのタイトル |
| `status` | `proposed` \| `active` \| `superseded` |
| `draft_status` | ドラフトの進行状態 (`idea` \| `exploring` \| `paused` \| `n/a`) |
| `created_at` | 作成日 (`YYYY-MM-DD`) |
| `updated_at` | 更新日 (`YYYY-MM-DD`) |
| `references` | 関連ドキュメントへのリンク配列（ない場合は空配列 `[]`） |
| `related_issues` | 関連Issueの番号配列 (ない場合は空配列 `[]`) |
| `related_prs` | 関連PRの番号配列 (ない場合は空配列 `[]`) |

## ドキュメント構造とテンプレート

Front-matterを簡素化する代わりに、ドキュメント種別ごとに推奨されるMarkdownの見出し構造（テンプレート）を定義する。
執筆者は以下の構造に従って本文を記述することで、必要な情報の網羅性を担保する。

### 共通セクション（全ドキュメント推奨）

注: **担当者名（Owners）の記述は不要。**

### Plan ドキュメントの構造例

計画書には、以前Front-matterで管理していたスコープや要件定義を本文として記述する。

```markdown
## Overview
概要を記述。

## Scope
- 実装する機能範囲
- 変更の影響範囲

## Non-Goals
- 今回のスコープに含まれないもの

## Requirements
- **Functional**: 機能要件
- **Non-Functional**: 非機能要件

## Tasks
- 実装タスク一覧

## Test Plan
- テスト戦略、観点

## Deployment / Rollout
- デプロイ手順、ロールバック方針
````

### Draft ドキュメントの構造例

```markdown
## Hypothesis
- 検証したい仮説

## Options / Alternatives
- 検討中の選択肢
- トレードオフの比較
```

**ただし、draft はあくまでメモ置き場であるため、必須セクションは特に定めない。趣旨が一致する場合のみセクション名を踏襲すること。**

## 対象読者

  - **主要読者**: 新メンバー・対象領域の実装に関わっていない人
  - **技術レベル**: Flutter/Dart中級者～上級者を前提
  - **学習目的ではなく「ドキュメント」としての品質を優先**
  - **特記事項**: AIエージェントも読者として想定

## 言語・記法ルール

### 言語使用方針

  - **API名・クラス名・メソッド名**: 英語のまま記載
  - **説明文・本文**: 日本語で記述
  - **固有名詞**: 原語で記載（Flutter, Dart, Riverpod 等）
  - **技術用語**: 一般的な基準で記述（明文化しない）

### 専門用語・略語

  - **初出時**: 正式名称+略語併記（例：「NDJSON（Newline Delimited JSON）」）
  - **2回目以降**: 略語のみ使用可
  - **プロジェクト固有用語集**: 作成しない

### Markdown記法

  - **見出しレベル**:
      - `#`: 文書タイトル
      - `##`: 大セクション
      - `###`: 中セクション
      - `####以下`: 小セクション
  - **コードブロック**: 言語指定を推奨
  - **表・リスト・引用**: 特定スタイルの指定なし

### コード記載ルール

  - **コード引用**: 現状をそのまま保持
  - **コード例**:
      - 変数名: 英語
      - コメント: 日本語
  - **API名**: 英語のまま、説明は日本語

## 実装ステータスの扱い

### ステータス表記方針

  - **reference/**: 実装済み機能のみ記載を原則
  - **実装中機能**: 記載しない (plan/ に記述)
  - **未実装機能**: 記載しない（plan/ に記述）
  - **バージョン情報**: 不要
  - **実装時期**: 明記する

### ドキュメント種別別の扱い

| ドキュメント種別 | 実装済み | 開発中 | 未実装・計画中 |
|------------------|----------|--------|----------------|
| guide/           | ✅記載   | ❌記載しない | ❌記載しない |
| reference/       | ✅記載   | ❌記載しない | ❌記載しない |
| plan/            | ✅記載   | ✅記載   | ✅記載 |
| intent/          | ✅記載   | ✅記載   | ✅記載 |

## メンテナンス方針

### 更新フロー

1.  **大規模変更 (Size \>= M)**:

      - 実装意図・設計メモを `_docs/draft/(対象)/` に記録してから実装を開始する。
      - または `_docs/plan/(対象)/` を作成・更新する。

2.  **小規模変更 (Size \< M)**:

      - **特例**: `TODO.md` 上でタスク定義が明確（Stepsに手順記載済み）であり、かつ意図が自明な修正（バグ修正や軽微なリファクタリング）の場合、**`draft` の作成を省略できる**。
      - この場合、コミットメッセージやPRのDescriptionに実装意図を含めることで代替とする。

3.  **定期的**: メモを基に正式ドキュメントへ昇華

4.  **レビュー**: 正式ドキュメント完成時、関与領域更新時、定期的（2\~3ヶ月）

### 更新タイミング

  - **優先度**: 明確に設けないが、暗黙的に「新機能 \> リファクタリング」順になる可能性（排除しない）
  - **時間経過**: 実装時の意図や目的がブレやすいため、コミット時のメモ作成を重視

### 整合性チェック & 自動化

  - **手法**: lint（markdownlint-cli2） / link-check（lychee） / front-matter 検証を使用。
  - **現状**: 自動化フェーズの移行中。CI 未導入の項目はレビュー時に手動確認する。
  - **対応ルール**:
    1.  **発見時対応**: 問題を見つけた人が修正または Issue 作成。Issue 番号は該当ドキュメントの `front-matter` の `related_issues` に追記。
    2.  **優先度**: 実害のある不整合 \> 表記の不統一 \> 軽微な古い情報。
    3.  **修正範囲**: 関連する `guide/` や `reference/` を同時に確認し、必要なら plan / intent も更新する。

### 品質保証

  - **レビュータイミング**:
      - 正式ドキュメント完成時
      - 関与領域更新時（簡易レビュー）
      - 定期棚卸し（Docs Platform WG が四半期ごとに実施）
  - **古い情報の検出**: lint / link-check と手動レビューを併用。

## 重複・相互参照方針

### 重複について

  - **基本方針**: 各ドキュメントの目的達成のために必要であれば重複を許容
  - **制約**: 目的に特化しすぎず、ある程度汎用的に仕上げる

### 相互参照

  - **guide → reference**: ガイドの根拠として参照
      - 例：「`reference/logging-api.md` の LogLevel 仕様に基づいて...」
  - **reference → guide**: 補足説明や実践的使用方法の誘導
      - 例：「実際の使用例は `guide/logging.md` を参照」
      - 例：「`guide/logging.md` に実例とチュートリアルが記載されています」
  - **同一ディレクトリ内**: 必要に迫られた場合のみ（基本的には想定しない）

## 新機能のドキュメント作成手順

1.  **実装開始時**: `_docs/draft/(機能名)/` にメモ・草案を作成
2.  **調査フェーズ**: 重要な調査・検証結果を `_docs/survey/(機能名)/` に整理して保存
3.  **実装中**: 重要な設計判断を `_docs/draft/(機能名)/intent_notes.md` に記録
4.  **実装完了後**:
      - `_docs/intent/(機能名)/` に設計意図ドキュメント作成
      - `_docs/reference/(機能名)/` にAPI仕様リファレンス作成
      - `_docs/guide/(機能名)/` に使用方法ガイド作成
5.  **レビュー**: 各ドキュメントをレビューし正式化
6.  **クリーンアップ**: `_docs/draft/(機能名)/` を整理・移動・削除し、必要に応じて survey ドキュメントを更新。

## よくある質問

### Q: どのディレクトリに書けばよいか分からない場合は？

A: まず `_docs/draft/` に書き始めてください。内容が固まってから適切な場所に移動します。

### Q: 既存ドキュメントとの整合性が心配な場合は？

A: 関連する guide/ と reference/ を同時に確認し、必要に応じて両方を更新してください。

### Q: 実装途中の機能をドキュメント化すべきか？

A: plan/ に記述し、実装完了後に guide/ と reference/ 、intent/ を作成してください。

